<!DOCTYPE html>
<html xmlns:th=http://www.thymeleaf.org>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>땅판소년단 임장단 메인</title>

    <link th:href="@{/css/memomap.css}" rel="stylesheet">

    <!-- Latest compiled and minified CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>

<!--<h1>땅판소년단 임장단 메인 페이지입니다.</h1>-->

<!-- A grey horizontal navbar that becomes vertical on small screens -->
<nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <div class="container-fluid container-xxl">
        <a class="navbar-brand" href="javascript:void(0)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
                <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
            </svg>
            IMJANGDAN
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mynavbar">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/homememo">메모</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/news">뉴스</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/bbslist">커뮤니티</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/reagents">공인중개사</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/financing">파이낸싱</a>
                </li>
            </ul>
            <!--            <form class="d-flex">-->
            <!--                <input class="form-control me-2" type="text" placeholder="Search">-->
            <!--                <button class="btn btn-primary" type="button">Search</button>-->
            <!--            </form>-->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/login">로그인</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:3000/join">회원가입</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!--<div class="searchBox"></div>-->

<!--<div id="map" class="mapBox"></div>-->

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0aca019ed744ce53b052c556e44d8239"></script>
<!--<script>-->
<!--    var script = document.createElement('script');-->
<!--    script.src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0aca019ed744ce53b052c556e44d8239";-->
<!--    document.head.appendChild(script);-->
<!--</script>-->

<script type="text/javascript" th:src="@{/js/memomap.js}"></script>
<div id="map" class="mapBox" ></div>
<script>
 

// 클릭 횟수를 저장하는 변수
var clickCount = 0;

// 기존의 마커 변수를 선언합니다.
var marker;

var infowindow; // infowindow 변수를 정의 및 초기화

<!--var memoClick = 0;-->

function displayAddress(latitude, longitude) {
    // 좌표를 주소로 변환하는 역 지오코딩 요청을 보냅니다.
    kakao.maps.services.Geocoder.coord2Address(new kakao.maps.LatLng(latitude, longitude), function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
            // 역 지오코딩이 성공하면 주소 정보를 가져와서 인포윈도우에 표시합니다.
            const address = result[0].address.address_name;
            const content = `<div>현재 위치: ${address}</div>`;
            infowindow.setContent(content);
            infowindow.open(map, marker);
        } else {
            // 역 지오코딩이 실패하면 에러 메시지를 표시합니다.
            alert('주소를 가져오지 못했습니다: ' + status);
        }
    });
}

// addButtonClick 함수 내에서 마커를 생성하고 업데이트합니다.
function addButtonClick() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // 클릭 횟수에 따라 동작을 분기
            if (clickCount % 2 === 0) {
                // 인포윈도우를 표시하고 마커를 생성 또는 업데이트합니다.
                const latlng = new kakao.maps.LatLng(latitude, longitude);
                map.setCenter(latlng);

                if (!marker) {
                    marker = new kakao.maps.Marker({
                        position: latlng,
                        map: map
                    });
                } else {
                    marker.setPosition(latlng);
                }

            // 메모 컴포넌트의 내용을 가져옵니다.
            const memoContent = document.getElementById('memo-component').innerHTML;

            // 인포윈도우에 표시할 내용을 생성합니다.
            const content = `<div>현재 위치: 위도 ${latitude}, 경도 ${longitude}</div>` + memoContent;

            // 인포윈도우를 생성하거나 업데이트합니다.
            if (!infowindow) {
                    infowindow = new kakao.maps.InfoWindow({
                        content: content,
                    });
                } else {
                    infowindow.setContent(content);
                }
                // 인포윈도우를 지도 위에 표시합니다.
                infowindow.open(map, marker);

                // 클릭 횟수를 증가합니다.
                clickCount++;
            }
        }, function(error) {
            // 위치 정보를 가져오지 못했을 때의 처리입니다.
            alert("위치 정보를 가져올 수 없습니다: " + error.message);
        });
    } else {
        // Geolocation을 지원하지 않는 경우의 처리입니다.
        alert("이 브라우저에서는 Geolocation을 지원하지 않습니다.");
    }
}

// 나머지 코드는 그대로 유지됩니다.
    // 기존의 지도 생성 코드와 마커 클릭 시 인포윈도우 열기 코드는 그대로 유지
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.58158, 126.8868), // 지도의 중심좌표
            level: 4 // 지도의 확대 레벨
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', // 마커이미지의 주소입니다
        imageSize = new kakao.maps.Size(64, 69), // 마커이미지의 크기입니다
        imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.

    // 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption),
        markerPosition = new kakao.maps.LatLng(37.58158, 126.8868); // 마커가 표시될 위치입니다

    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        position: markerPosition,
        image: markerImage // 마커이미지 설정
    });

    // 마커가 지도 위에 표시되도록 설정합니다
    marker.setMap(map);

    // 커스텀 오버레이에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
    var content = '<div class="customoverlay">' +
        '  <a href="https://map.kakao.com/link/map/11394059" target="_blank">' +
        '    <span class="title">상암IT센터</span>' +
        '  </a>' +
        '</div>';

    // 커스텀 오버레이가 표시될 위치입니다
    var position = new kakao.maps.LatLng(37.58158, 127.8868);

    // 커스텀 오버레이를 생성합니다
    var customOverlay = new kakao.maps.CustomOverlay({
        map: map,
        position: position,
        content: content,
        yAnchor: 1
    });


    // 마커를 표시할 위치와 title 객체 배열입니다
    var positions = [
        {
            title: '재한몽골학교',
            latlng: new kakao.maps.LatLng(37.34699, 127.09598)
        },
        {
            title: '래미안파크스위트아파트',
            latlng: new kakao.maps.LatLng(37.519, 127.01287)
        },
        {
            title: '대한예수교장로회성동교회',
            latlng: new kakao.maps.LatLng(37.5499, 127.09518)
        },
        {
            title: '광진파크프라이빗아파트',
            latlng: new kakao.maps.LatLng(37.54299, 127.06598)
        }
    ];
    // 마커 이미지의 이미지 주소입니다
    var imageSrc = "/images/memo-icon2.png";

    for (var i = 0; i < positions.length; i++) {
        // 마커 이미지의 이미지 크기입니다
        var imageSize = new kakao.maps.Size(35, 40);
        // 마커 이미지를 생성합니다
        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
        // 마커를 생성합니다
        var marker = new kakao.maps.Marker({
            map: map, // 마커를 표시할 지도
            position: positions[i].latlng, // 마커를 표시할 위치
            title: positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
            image: markerImage // 마커 이미지
        });
    }


</script>

<div id="news-component">
    <h2>뉴스</h2>
    <ul>
        <li>뉴스 항목 1</li>
        <li>뉴스 항목 2</li>
        <li>뉴스 항목 3</li>
        <!-- 더미 데이터를 원하는 만큼 추가하세요 -->
    </ul>
</div>

<div id="memo-component">
    <h2>메모</h2>
    <ul id="memo-list">
        <!-- 메모가 동적으로 추가될 자리 -->
    </ul>
</div>



<script src="/src/main/resources/static/js/memomap.js"></script>

<button class="add-button" onclick="addButtonClick()">+</button>

</body>
</html>
<style>
    .add-button {
        position: fixed;
        left: 20px;
        bottom: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #007bff; /* Bootstrap primary color */
        color: white;
        font-size: 24px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        z-index: 1000;
    }
</style>



